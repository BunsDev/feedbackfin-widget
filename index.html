<head>
  <link rel="stylesheet" href="./style.css" />
</head>

<body
  style="
    font-family: system-ui;
    display: grid;
    place-items: center;
    background: #808080;
  "
>
  <form id="feedbackfin__form">
    <h1 id="feedbackfin__title">Send feedback</h1>

    <button
      id="feedbackfin__close"
      class="feedbackfin__icon-button"
      type="reset"
      aria-label="Close"
    >
      <svg
        width="1em"
        height="1em"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2.4"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="feather feather-x"
      >
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>

    <div
      id="feedbackfin__radio-group"
      role="radiogroup"
      aria-label="Feedback type"
    >
      <input
        class="feedbackfin__radio"
        type="radio"
        id="feedback-type__issue"
        name="feedbackType"
        value="issue"
        required
      />
      <label
        for="feedback-type__issue"
        class="feedbackfin__button feedbackfin__radio-label"
      >
        <span class="feedbackfin__radio-icon">❗️</span> Issue
      </label>

      <input
        class="feedbackfin__radio"
        type="radio"
        id="feedback-type__idea"
        name="feedbackType"
        value="idea"
        required
      />
      <label
        for="feedback-type__idea"
        class="feedbackfin__button feedbackfin__radio-label"
      >
        <span class="feedbackfin__radio-icon">💡</span> Idea
      </label>

      <input
        class="feedbackfin__radio"
        type="radio"
        id="feedback-type__other"
        name="feedbackType"
        value="other"
        required
      />
      <label
        for="feedback-type__other"
        class="feedbackfin__button feedbackfin__radio-label"
      >
        <span class="feedbackfin__radio-icon">💭</span> Other
      </label>
    </div>

    <div id="feedbackfin__step2">
      <textarea
        id="feedbackfin__message"
        name="message"
        type="text"
        placeholder="I think…"
        required
        rows="2"
        aria-label="Message"
      ></textarea>

      <button
        id="feedbackfin__submit"
        class="feedbackfin__button"
        type="submit"
      >
        Send
      </button>
    </div>

    <div id="feedbackfin__branding">
      <a href="https://feedbackfin.com" target="_blank" rel="noopener">
        Powered by Feedback Fin
      </a>
    </div>
  </form>

  <script>
    window.feedbackfin = {
      url: "",
      user: {},
    };

    const handleTypeChange = (e) => {
      document
        .getElementById("feedbackfin__form")
        .setAttribute("data-feedback-type", e.target.value);

      let placeholder = "I think…";
      switch (e.target.value) {
        case "issue":
          placeholder = "I’m having an issue with…";
          break;

        case "idea":
          placeholder = "I’d like to see…";
          break;
      }
      document
        .getElementById("feedbackfin__message")
        .setAttribute("placeholder", placeholder);
    };
    Array.from(document.getElementsByClassName("feedbackfin__radio")).forEach(
      (el) => {
        el.addEventListener("change", handleTypeChange);
      }
    );

    const handleReset = () => {
      document
        .getElementById("feedbackfin__form")
        .removeAttribute("data-feedback-type");
      document
        .getElementById("feedbackfin__message")
        .setAttribute("placeholder", "I think…");
    };
    document
      .getElementById("feedbackfin__close")
      .addEventListener("click", handleReset);

    const handleSubmit = (e) => {
      e.preventDefault();

      if (!window.feedbackfin.url)
        console.error("Feedback Fin: No URL provided");

      const myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");

      const data = {
        ...window.feedbackfin.user,
        feedbackType: e.target.elements.feedbackType.value,
        message: e.target.elements.message.value,
        timestamp: Date.now(),
      };

      fetch(window.feedbackfin.url, {
        method: "POST",
        headers: myHeaders,
        body: JSON.stringify(data),
      }).catch((e) => {
        console.error("Feedback Fin:", e);
        if (!window.feedbackfin.disableErrorAlert)
          alert(`Could not send feedback: ${e.message}`);
      });

      return false;
    };
    document
      .getElementById("feedbackfin__form")
      .addEventListener("submit", handleSubmit);
  </script>
</body>
